# Проект "IT Quiz Bot" — Telegram-бот

Этот проект представляет собой Telegram-бота для проведения викторины по теме IT. Бот задает вопросы и подсчитывает очки за правильные ответы, сохраняя прогресс пользователя в базе данных Yandex Database (YDB).

## Функционал и команды бота

*   **`/start`**: Приветствует пользователя и предлагает начать квиз. Отправляет кнопку "Начать квиз".
*   **`/quiz` или кнопка "Начать квиз"**: Начинает или перезапускает квиз для пользователя, сбрасывая прогресс и очки. Удаляет предыдущее сообщение бота с вопросом/результатом.
*   **Ответы на вопросы (Inline кнопки)**: После получения вопроса, пользователь выбирает вариант ответа, нажимая на соответствующую кнопку.
    *   При правильном ответе начисляются очки.
    *   Бот оставляет сообщение с вопросом и выводит финальный результат.

## Как работает

1.  **Начало квиза**: Пользователь отправляет `/start` или `/quiz`, либо нажимает кнопку "Начать квиз".
2.  **Очистка**: Бот пытается удалить предыдущее основное сообщение квиза в чате (если оно было) и сбрасывает прогресс пользователя в Yandex Database.
3.  **Вопросы**: Бот загружает текущий вопрос из списка и отправляет его пользователю с вариантами ответов в виде Inline-кнопок.
4.  **Ответы**: Пользователь выбирает ответ. Бот проверяет его, обновляет счет и индекс текущего вопроса в Yandex Database. Сообщение с вопросом удаляется.
5.  **Следующий вопрос**: Если вопросы еще есть, бот отправляет следующий.
6.  **Завершение**: После ответа на последний вопрос, бот выводит финальное количество набранных очков.

## Технологии

*   **Язык программирования**: Python
*   **Фреймворк для разработки ботов**: aiogram 3
*   **База данных**: Yandex Database (YDB)
*   **Размещение**: Yandex Cloud Functions (Serverless)
*   **Взаимодействие с API**: Вебхуки

## Запуск проекта в Yandex Cloud Functions

Для запуска проекта в Yandex Cloud Functions вам потребуется аккаунт в Яндекс.Облаке и настроенная Yandex Database.

1.  **Подготовка базы данных YDB**:
    *   Создайте базу данных YDB в Яндекс.Облаке (Serverless режим рекомендован).
    *   Получите **Endpoint** и **Database name** вашей базы данных.
    *   Выполните команды из файла `sql.txt`, чтобы создать таблицу `quiz_state` для хранения состояния пользователей:
        ```bash
        # Пример выполнения команд sql.txt с помощью YDB CLI
        ydb yql --endpoint <YOUR_YDB_ENDPOINT> --database <YOUR_YDB_DATABASE> -f sql.txt
        ```
        Замените `<YOUR_YDB_ENDPOINT>` и `<YOUR_YDB_DATABASE>` на данные вашей БД.

2.  **Получение токена бота**:
    *   Создайте нового бота в Telegram через @BotFather и получите его **API Token**.

3.  **Подготовка файлов проекта**:
    *   Убедитесь, что у вас есть все файлы проекта: `tb_webhook.py`, `database.py`, `handlers.py`, `service.py`, `requirements.txt`, `sql.txt`.

4.  **Сборка архива для деплоя**:
    *   Установите зависимости локально (рекомендуется в виртуальном окружении):
        ```bash
        pip install -r requirements.txt
        ```
    *   Создайте ZIP-архив, который включает **все файлы проекта** (`.py`, `.txt`) и **все установленные зависимости** из вашего виртуального окружения. Инструменты типа `pip install -t <папка_зависимостей> -r requirements.txt` могут помочь в сборе зависимостей в отдельную папку перед архивацией.

5.  **Создание и настройка функции в Yandex Cloud Functions**:
    *   В консоли Яндекс.Облака перейдите в сервис Functions.
    *   Создайте новую функцию.
    *   Выберите среду выполнения **Python 3.12**.
    *   В качестве исходного кода выберите **"Файл или архив"** и загрузите созданный вами ZIP-архив.
    *   Укажите **Точку входа**: `tb_webhook.webhook` (имя файла без `.py` и имя функции).
    *   Настройте **Переменные окружения**:
        *   `API_TOKEN`: Ваш API Token Telegram бота.
        *   `YDB_ENDPOINT`: Endpoint вашей Yandex Database.
        *   `YDB_DATABASE`: Database name вашей Yandex Database.
        *   (Опционально) Настройте необходимые сетевые правила для доступа функции к YDB.
    *   Сохраните функцию.

6.  **Настройка вебхука Telegram**:
    *   После создания функции, вы получите **URL** для ее вызова.
    *   Используйте этот URL для установки вебхука вашего Telegram бота. Вы можете сделать это, отправив HTTP GET запрос на адрес `https://api.telegram.org/bot<ВАШ_API_ТОКЕН>/setWebhook?url=<URL_ВАШЕЙ_ФУНКЦИИ>`. Замените `<ВАШ_API_ТОКЕН>` и `<URL_ВАШЕЙ_ФУНКЦИИ>`.
    *   Проверить статус вебхука можно запросом `https://api.telegram.org/bot<ВАШ_API_ТОКЕН>/getWebhookInfo`.

## Ссылка на бота
https://t.me/new_ask_bot

---

**Приятной игры с ботом!**
